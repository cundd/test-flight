#!/usr/bin/env php
<?php

if (file_exists(__DIR__.'/../vendor/autoload.php')) {
    require_once __DIR__.'/../vendor/autoload.php';
} else {
    throw new Exception('Could not find autoloader');
}

$objectManager = new \Cundd\TestFlight\ObjectManager();

$locales = [
    LC_CTYPE => setlocale(LC_CTYPE, 0),
    LC_NUMERIC => setlocale(LC_NUMERIC, 0),
    LC_TIME => setlocale(LC_TIME, 0),
    LC_COLLATE => setlocale(LC_COLLATE, 0),
    LC_MONETARY => setlocale(LC_MONETARY, 0),
    LC_ALL => setlocale(LC_ALL, 0),
    LC_MESSAGES => setlocale(LC_MESSAGES, 0),
];

$environment   = new \Cundd\TestFlight\Environment(
    $_ENV,
    date_default_timezone_get(),
    $locales,
    error_reporting(null)
);
$environment->reset();
$classLoader     = new \Cundd\TestFlight\ClassLoader();
$provider        = new \Cundd\TestFlight\FileAnalysis\DefinitionProvider($classLoader);
$testDefinitions = $provider->findInDirectory(__DIR__.'/../src/');
$testRunner = new \Cundd\TestFlight\TestRunner($classLoader, $objectManager);
$testRunner->runTestDefinitions($testDefinitions);
?>